<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.72">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Chialisp Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Chialisp Blog Atom Feed"><title data-react-helmet="true">4 - The High Level Language, Compiler, and Functions | Chialisp</title><meta data-react-helmet="true" property="og:url" content="https://chialisp.com/docs/high_level_lang"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="4 - The High Level Language, Compiler, and Functions | Chialisp"><meta data-react-helmet="true" name="description" content="This guide assumes that you have already read the previous parts."><meta data-react-helmet="true" property="og:description" content="This guide assumes that you have already read the previous parts."><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://chialisp.com/docs/high_level_lang"><link data-react-helmet="true" rel="alternate" href="https://chialisp.com/docs/high_level_lang" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://chialisp.com/docs/high_level_lang" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.524535a3.css">
<link rel="preload" href="/assets/js/styles.26f56164.js" as="script">
<link rel="preload" href="/assets/js/runtime~main.f5fd9829.js" as="script">
<link rel="preload" href="/assets/js/main.48016fb5.js" as="script">
<link rel="preload" href="/assets/js/1.770ac2bf.js" as="script">
<link rel="preload" href="/assets/js/2.51d5087f.js" as="script">
<link rel="preload" href="/assets/js/3.377891e5.js" as="script">
<link rel="preload" href="/assets/js/1be78505.d5247ac1.js" as="script">
<link rel="preload" href="/assets/js/24.7aadb6e8.js" as="script">
<link rel="preload" href="/assets/js/935f2afb.03b299c1.js" as="script">
<link rel="preload" href="/assets/js/17896441.1001ec9f.js" as="script">
<link rel="preload" href="/assets/js/77e6dc9a.5e2a4414.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="Chialisp Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.svg" alt="Chialisp Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Chialisp</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Docs</a><a href="https://chia.net/blog" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Blog</a><a href="https://chia.net" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Chia.net</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/Chia-Network/chialisp-web" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_GrZ2"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="Chialisp Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.svg" alt="Chialisp Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Chialisp</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/docs/">Docs</a></li><li class="menu__list-item"><a href="https://chia.net/blog" target="_blank" rel="noopener noreferrer" class="menu__link">Blog</a></li><li class="menu__list-item"><a href="https://chia.net" target="_blank" rel="noopener noreferrer" class="menu__link">Chia.net</a></li><li class="menu__list-item"><a href="https://github.com/Chia-Network/chialisp-web" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper main-docs-wrapper"><div class="docPage_31aa"><div class="docSidebarContainer_3Kbt" role="complementary"><div class="sidebar_15mo"><div class="menu menu--responsive thin-scrollbar menu_Bmed"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Chialisp</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/">1 - CLVM Basics</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/coins_spends_and_wallets">2 - Coins, Spends and Wallets</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/deeper_into_clvm">3 - Deeper into CLVM</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/high_level_lang">4 - The High Level Language, Compiler, and Functions</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/common_functions">5 - Common Functions in Chialisp</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/standard_transaction">6 - The Standard Transaction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/glossary">The Great Chia Glossary</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">CLVM</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/ref/clvm">1 - The CLVM</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/ref/serialization">2 - Serialization</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">FAQ</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/faq">ChiaLisp and CLVM FAQ</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3ufF"><div class="container padding-vert--lg docItemWrapper_3FMP"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><header><h1 class="docTitle_3a4h">4 - The High Level Language, Compiler, and Functions</h1></header><div class="markdown"><p>This guide assumes that you have already read the previous parts.
It is highly recommended that you do so as the higher level language is built directly on top of the lower level language.</p><h2 id="run">Run</h2><p>The first difference you need to be aware of for the higher level language is that you should call <code>run</code> instead of <code>brun</code>.
This lets the runtime know that it should be including higher level features.</p><p>The first higher level feature you should be aware of is that <strong>it is no longer necessary to quote atoms!</strong></p><p>Compare <code>brun</code> and <code>run</code> here:</p><pre><code class="language-lisp">$ brun &#x27;(+ 200 200)&#x27;
FAIL: first of non-cons ()
$ run &#x27;(+ 200 200)&#x27;
400
</code></pre><p>Run also gives us access to a number of convenient high level operators, which we will cover now.</p><h2 id="list">list</h2><p><code>list</code> takes any number of parameters and returns them put inside a list.
This saves us from having to manually create nested <code>(c (A) (c (B) (q ())))</code> calls, which can get messy quickly.</p><pre><code class="language-lisp">$ run &#x27;(list 100 &quot;test&quot; 0xdeadbeef)&#x27;
(100 &quot;test&quot; 0xdeadbeef)
</code></pre><h2 id="if">if</h2><p><code>if</code> automatically puts our <code>i</code> statement into the lazy evaluation form so we do not need to worry about the unused code path being evaluated.</p><pre><code class="language-lisp">$ run &#x27;(if 1 (q . &quot;success&quot;) (x))&#x27; &#x27;(100)&#x27;
&quot;success&quot;

$ run &#x27;(if 0 (q . &quot;success&quot;) (x))&#x27; &#x27;(100)&#x27;
FAIL: clvm raise ()
</code></pre><h2 id="qq-unquote">qq unquote</h2><p><code>qq</code> allows us to quote something with selected portions being evaluated inside by using <code>unquote</code>.
The advantages of this may not be immediately obvious but are extremely useful in practice as it allows us to substitute out sections of predetermined code.</p><p>Suppose we are writing a program that returns another coin&#x27;s puzzle.
We know that a puzzle takes the form: <code>(c (c (q . 50) (c (q . 0xpubkey) (c (sha256 2) (q . ())))) (a 5 11))</code>
However we will want to change 0xpubkey to a value passed to us through our solution.</p><p><strong>Note: <code>@</code> allows us to access the arguments in the higher level language (<code>@</code> == 1)</strong></p><pre><code class="language-lisp">$ run &#x27;(qq (c (c (q . 50) (c (q (unquote (f @))) (c (sha256 2) ()))) (a 5 11)))&#x27; &#x27;(0xdeadbeef)&#x27;

(c (c (q . 50) (c (q . 0xdeadbeef) (c (sha256 2) ()))) (a 5 11))
</code></pre><h2 id="compiling-to-clvm-with-mod">Compiling to CLVM with Mod</h2><p>It is important to remember that in practice smart contracts will run using the lower level language, so none of the above operators will work on the network.
What we <em>can</em> do however is compile them down to the lower level language.
This is where <code>mod</code> comes in.
<code>mod</code> is an operator that lets the runtime know that it needs to be compiling the code rather than actually running it.</p><p><code>(mod A B)</code> takes two or more parameters. The first is used to name parameters that are passed in, and the last is the higher level script which is to be compiled.</p><p>Below we name our arguments <code>arg_one</code> and <code>arg_two</code> and then access <code>arg_one</code> inside our main program</p><pre><code class="language-lisp">$ run &#x27;(mod (arg_one arg_two) (list arg_one))&#x27;
(c 2 ())
</code></pre><p>As you can see it returns our program in compiled lower level form.</p><pre><code class="language-lisp">$ brun &#x27;(c 2 ())&#x27; &#x27;(100 200 300)&#x27;
(100)
</code></pre><p>You may be wondering what other parameters <code>mod</code> takes, between variable names and source code.</p><h2 id="functions-macros-and-constants">Functions, Macros and Constants</h2><p>In the higher level language we can define functions, macros, and constants before our program by using <code>defun</code>, <code>defun-inline</code>, <code>defmacro</code> and <code>defconstant</code>.</p><p>We can define as many of these as we like before the main source code.
Usually a program will be structured like this:</p><pre><code class="language-lisp">(mod (arg_one arg_two)
  (defconstant const_name value)
  (defun function_name (parameter_one parameter_two) (*function_code*))
  (defun another_function (param_one param_two param_three) (*function_code*))
  (defun-inline utility_function (param_one param_two) (*function_code*))
  (defmacro macro_name (param_one param_two) (*macro_code*))

  (main *program*)
)
</code></pre><p>A few things to note:</p><ul><li>Functions can reference themselves in their code but macros and inlines cannot as they are inserted at compile time.</li><li>Both functions and macros can reference other functions, macros and constants.</li><li>Macros that refer to their parameters must be quasiquoted with the parameters unquoted</li><li>Be careful of infinite loops in macros that reference other macros.</li><li>Comments can be written with semicolons</li><li>Inline functions are generally more cost effective than regular functions except when reusing calculated arguments: <code>(defun-inline foo (X) (+ X X)) (foo (* 200 300))</code> will perform the expensive multiplication twice</li></ul><h2 id="factorial">Factorial</h2><pre><code class="language-lisp">(mod (arg_one)
  ; function definitions
  (defun factorial (input)
    (if (= input 1) 1 (* (factorial (- input 1)) input))
  )

  ; main
  (factorial arg_one)
)
</code></pre><p>We can save these files to .clvm files which can be run from the command line.
Saving the above example as <code>factorial.clvm</code> allows us to do the following.</p><pre><code class="language-lisp">$ run factorial.clvm
(a (q 2 2 (c 2 (c 5 ()))) (c (q 2 (i (= 5 (q . 1)) (q 1 . 1) (q 18 (a 2 (c 2 (c (- 5 (q . 1)) ()))) 5)) 1) 1))

$ brun &#x27;(a (q 2 2 (c 2 (c 5 ()))) (c (q 2 (i (= 5 (q . 1)) (q 1 . 1) (q 18 (a 2 (c 2 (c (- 5 (q . 1)) ()))) 5)) 1) 1))&#x27; &#x27;(5)&#x27;
120
</code></pre><h2 id="squaring-a-list">Squaring a List</h2><p>Now lets do an example which uses macros as well.
When writing a macro it must be quasiquoted with the parameters being unquoted.</p><p>We can also take this time to show another feature of the compiler.
You can name each parameter in a list or you can name the list itself.
This works at any place where you name parameters, and allows you to handle lists where you aren&#x27;t sure of the size.</p><p>Here we define a macro to square a parameter and then a function to square a list.</p><pre><code class="language-lisp">(mod args

  (defmacro square (input)
    (qq (* (unquote input) (unquote input)))
  )

  (defun sqre_list (my_list)
    (if my_list
      (c (square (f my_list)) (sqre_list (r my_list)))
      my_list
    )
  )

  (sqre_list args)
)
</code></pre><p>Compiling and running this code results in this:</p><pre><code class="language-lisp">$ run square_list.clvm
(a (q 2 2 (c 2 (c 3 ()))) (c (q 2 (i 5 (q 4 (* 9 9) (a 2 (c 2 (c 13 ())))) (q . 5)) 1) 1))

$ brun &#x27;(a (q 2 2 (c 2 (c 3 ()))) (c (q 2 (i 5 (q 4 (* 9 9) (a 2 (c 2 (c 13 ())))) (q . 5)) 1) 1))&#x27; &#x27;(10 9 8 7)&#x27;
(100 81 64 49)
</code></pre><h2 id="conclusion">Conclusion</h2><p>You should now have the context and knowledge needed to write your own Chialisp programs.
Remember from <a href="/docs/coins_spends_and_wallets/">part 2</a> that these programs run on the blockchain and instruct the blockchain what to do with the coin&#x27;s value.</p><p>If you have further questions feel free to ask on <a href="https://keybase.io/team/chia_network.public">Keybase</a>.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/Chia-Network/chialisp-web/edit/master/docs/high_level_lang.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/deeper_into_clvm"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« 3 - Deeper into CLVM</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/common_functions"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">5 - Common Functions in Chialisp Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#run" class="table-of-contents__link">Run</a></li><li><a href="#list" class="table-of-contents__link">list</a></li><li><a href="#if" class="table-of-contents__link">if</a></li><li><a href="#qq-unquote" class="table-of-contents__link">qq unquote</a></li><li><a href="#compiling-to-clvm-with-mod" class="table-of-contents__link">Compiling to CLVM with Mod</a></li><li><a href="#functions-macros-and-constants" class="table-of-contents__link">Functions, Macros and Constants</a></li><li><a href="#factorial" class="table-of-contents__link">Factorial</a></li><li><a href="#squaring-a-list" class="table-of-contents__link">Squaring a List</a></li><li><a href="#conclusion" class="table-of-contents__link">Conclusion</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/">CLVM Basics</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/coins_spends_and_wallets/">Coins, Spends and Wallets</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://keybase.io/team/chia_network.public" target="_blank" rel="noopener noreferrer" class="footer__link-item">Keybase</a></li><li class="footer__item"><a href="https://twitter.com/chia_project" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a href="https://www.chia.net/blog/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog</a></li><li class="footer__item"><a href="https://github.com/Chia-Network/clvm" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 Chia Network Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/styles.26f56164.js"></script>
<script src="/assets/js/runtime~main.f5fd9829.js"></script>
<script src="/assets/js/main.48016fb5.js"></script>
<script src="/assets/js/1.770ac2bf.js"></script>
<script src="/assets/js/2.51d5087f.js"></script>
<script src="/assets/js/3.377891e5.js"></script>
<script src="/assets/js/1be78505.d5247ac1.js"></script>
<script src="/assets/js/24.7aadb6e8.js"></script>
<script src="/assets/js/935f2afb.03b299c1.js"></script>
<script src="/assets/js/17896441.1001ec9f.js"></script>
<script src="/assets/js/77e6dc9a.5e2a4414.js"></script>
</body>
</html>