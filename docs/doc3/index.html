<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.72">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Chialisp Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Chialisp Blog Atom Feed"><title data-react-helmet="true">3 - Deeper into CLVM | Chialisp</title><meta data-react-helmet="true" property="og:url" content="https://chialisp.com/docs/doc3"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="3 - Deeper into CLVM | Chialisp"><meta data-react-helmet="true" name="description" content="This guide directly continues on from part 1 so if you haven&#x27;t read that, please do so before reading this."><meta data-react-helmet="true" property="og:description" content="This guide directly continues on from part 1 so if you haven&#x27;t read that, please do so before reading this."><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://chialisp.com/docs/doc3"><link data-react-helmet="true" rel="alternate" href="https://chialisp.com/docs/doc3" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://chialisp.com/docs/doc3" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.fb6aea02.css">
<link rel="preload" href="/assets/js/styles.e7753fea.js" as="script">
<link rel="preload" href="/assets/js/runtime~main.d0af800e.js" as="script">
<link rel="preload" href="/assets/js/main.79f0c603.js" as="script">
<link rel="preload" href="/assets/js/1.0bd0d2c4.js" as="script">
<link rel="preload" href="/assets/js/2.6e67f991.js" as="script">
<link rel="preload" href="/assets/js/3.e79e427a.js" as="script">
<link rel="preload" href="/assets/js/1be78505.5135d52c.js" as="script">
<link rel="preload" href="/assets/js/21.45426fa8.js" as="script">
<link rel="preload" href="/assets/js/935f2afb.63bb0b49.js" as="script">
<link rel="preload" href="/assets/js/17896441.c2bef226.js" as="script">
<link rel="preload" href="/assets/js/616665f6.998f7713.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="Chialisp Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.svg" alt="Chialisp Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Chialisp</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Docs</a><a href="https://chia.net/blog" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Blog</a><a href="https://chia.net" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Chia.net</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/Chia-Network/chialisp-web" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_GrZ2"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="Chialisp Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.svg" alt="Chialisp Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Chialisp</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/docs/">Docs</a></li><li class="menu__list-item"><a href="https://chia.net/blog" target="_blank" rel="noopener noreferrer" class="menu__link">Blog</a></li><li class="menu__list-item"><a href="https://chia.net" target="_blank" rel="noopener noreferrer" class="menu__link">Chia.net</a></li><li class="menu__list-item"><a href="https://github.com/Chia-Network/chialisp-web" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper main-docs-wrapper"><div class="docPage_31aa"><div class="docSidebarContainer_3Kbt" role="complementary"><div class="sidebar_15mo"><div class="menu menu--responsive thin-scrollbar menu_Bmed"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Chialisp</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/">1 - CLVM Basics</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/doc2">2 - Coins, Spends and Wallets</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/doc3">3 - Deeper into CLVM</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/doc4">4 - The High Level Language, Compiler, and Functions</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/doc5">The Great Chia Glossary</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">CLVM</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/ref/clvm">1 - The CLVM</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/ref/serialization">2 - Serialization</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">FAQ</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/faq">ChiaLisp and CLVM FAQ</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3ufF"><div class="container padding-vert--lg docItemWrapper_3FMP"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><header><h1 class="docTitle_3a4h">3 - Deeper into CLVM</h1></header><div class="markdown"><p>This guide directly continues on from <a href="/docs/">part 1</a> so if you haven&#x27;t read that, please do so before reading this.</p><p>This section of the guide will cover how ChiaLisp relates to transactions and coins on the Chia network.
If there are any terms that you aren&#x27;t sure of, be sure to check the <a href="/docs/doc5">glossary</a>.</p><h2 id="lazy-evaluation-in-chialisp">Lazy Evaluation in ChiaLisp</h2><p>As we saw in part 1, programs are often structured around <code>(i A B C)</code> to control flow.
ChiaLisp evaluates programs as trees, where the leaves are evaluated first.
This can cause unexpected problems if you are not aware of it.
Consider the following program which uses <code>x</code> which immediately halts and throws an error if it is evaluated.</p><pre><code class="language-lisp">$ brun &#x27;(i (q . 1) (q . 100) (x (q . &quot;still being evaluated&quot;)))&#x27;
FAIL: clvm raise (0x7374696c6c206265696e67206576616c7561746564)
</code></pre><p>This is because ChiaLisp evaluates both of the leaves even though it will only follow the path of one.</p><p>To get around this we can use the following design pattern to replace (i A B C).</p><pre><code class="language-lisp">(a (i (A) (q B) (q C)) (a))
</code></pre><p>Applying this to our above example looks like this:</p><pre><code class="language-lisp">$ brun &#x27;(a (i (q . 1) (q . (q . 100)) (q . (x (q . &quot;still being evaluated&quot;)))) 1)&#x27;
100
</code></pre><p>It is worth keeping this in mind whenever you write an <code>(i A B C)</code>.</p><p>If you&#x27;re wondering how this works (and how the standard transaction from <a href="/docs/doc2">part 2</a> worked), then allow me to introduce Evaluate.</p><h2 id="introduction-to-evaluate">Introduction to Evaluate</h2><p>In <a href="/docs/">Part 1</a> we mentioned that a program is usually a list where the first element is an operator, and every subsequent element is a valid program.
We can also run programs with new arguments inside a program.</p><p>This looks like this:</p><pre><code class="language-lisp">(a *(puzzle)* (*solution)*)
</code></pre><p>Let&#x27;s put this into practice.</p><p>Here is a program that evaluates the program <code>(+ 2 (q 5)))</code> and uses the list <code>(70 80 90)</code> or <code>(80 90 100)</code> as the solution.</p><pre><code class="language-lisp">$ brun &#x27;(a (q . (+ 2 (q . 5))) (q . (70 80 90)))&#x27; &#x27;(20 30 40)&#x27;
75

$ brun &#x27;(a (q . (+ 2 (q . 5))) (q . (80 90 100)))&#x27; &#x27;(20 30 40)&#x27;
85

</code></pre><p>Notice how the original solution <code>(20 30 40)</code> does not matter for the new evaluation environment.
In this example we use <code>q . </code> to quote both the new puzzle and the new solution to prevent them from being prematurely evaluated.</p><p>A neat trick that we can pull is that we can define the new solution in terms of the outer solution.
In this next example we will add the first element of the old solution to our new solution.</p><pre><code class="language-lisp">$ brun &#x27;(a (q . (+ 2 (q . 5))) (c 2 (q . (70 80 90))))&#x27; &#x27;(20 30 40)&#x27;
25
</code></pre><p>However it&#x27;s not just the new solution that we can affect using this, we can also pass programs as parameters.</p><h2 id="programs-as-parameters">Programs as Parameters</h2><p>The core CLVM does not have an operator for creating user defined functions.
It does, however, allow programs to be passed as parameters, which can be used for similar results.</p><p>Here is a puzzle that executes the program contained in <code>2</code> (the first solution argument) with the solution <code>(12)</code>.</p><pre><code class="language-lisp">$ brun &#x27;(a 2 (q . (12)))&#x27; &#x27;((* 2 (q . 2)))&#x27;
24
</code></pre><p>Taking this further we can make the puzzle run a new evaluation that only uses parameters from its old solution:</p><pre><code class="language-lisp">$ brun &#x27;(a 2 1)&#x27; &#x27;((* 5 (q . 2)) 10)&#x27;
20
</code></pre><p>We can use this technique to implement recursive programs.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/Chia-Network/chialisp-web/edit/master/docs/doc3.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/doc2"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« 2 - Coins, Spends and Wallets</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/doc4"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">4 - The High Level Language, Compiler, and Functions Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#lazy-evaluation-in-chialisp" class="table-of-contents__link">Lazy Evaluation in ChiaLisp</a></li><li><a href="#introduction-to-evaluate" class="table-of-contents__link">Introduction to Evaluate</a></li><li><a href="#programs-as-parameters" class="table-of-contents__link">Programs as Parameters</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/">CLVM Basics</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/doc2/">Coins, Spends and Wallets</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://keybase.io/team/chia_network.public" target="_blank" rel="noopener noreferrer" class="footer__link-item">Keybase</a></li><li class="footer__item"><a href="https://twitter.com/chia_project" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a href="https://www.chia.net/blog/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog</a></li><li class="footer__item"><a href="https://github.com/Chia-Network/clvm" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 Chia Network Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/styles.e7753fea.js"></script>
<script src="/assets/js/runtime~main.d0af800e.js"></script>
<script src="/assets/js/main.79f0c603.js"></script>
<script src="/assets/js/1.0bd0d2c4.js"></script>
<script src="/assets/js/2.6e67f991.js"></script>
<script src="/assets/js/3.e79e427a.js"></script>
<script src="/assets/js/1be78505.5135d52c.js"></script>
<script src="/assets/js/21.45426fa8.js"></script>
<script src="/assets/js/935f2afb.63bb0b49.js"></script>
<script src="/assets/js/17896441.c2bef226.js"></script>
<script src="/assets/js/616665f6.998f7713.js"></script>
</body>
</html>